{
  "version": 3,
  "file": "yarn.js",
  "sourceRoot": "",
  "sources": [
    "../src/yarn.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import BluebirdPromise from \"bluebird-lst\"\nimport { asArray, spawn } from \"electron-builder-util\"\nimport { exists } from \"electron-builder-util/out/fs\"\nimport { log, warn } from \"electron-builder-util/out/log\"\nimport { homedir } from \"os\"\nimport * as path from \"path\"\nimport { Config } from \"./metadata\"\nimport { readInstalled } from \"./readInstalled\"\n\nexport async function installOrRebuild(config: Config, appDir: string, electronVersion: string, platform: string, arch: string, forceInstall: boolean = false) {\n  const args = asArray(config.npmArgs)\n  if (forceInstall || !(await exists(path.join(appDir, \"node_modules\")))) {\n    await installDependencies(appDir, electronVersion, platform, arch, args, !config.npmSkipBuildFromSource)\n  }\n  else {\n    await rebuild(appDir, electronVersion, platform, arch, args, !config.npmSkipBuildFromSource)\n  }\n}\n\nexport function getGypEnv(electronVersion: string, platform: string, arch: string, buildFromSource: boolean) {\n  const gypHome = path.join(homedir(), \".electron-gyp\")\n  return Object.assign({}, process.env, {\n    npm_config_disturl: \"https://atom.io/download/electron\",\n    npm_config_target: electronVersion,\n    npm_config_runtime: \"electron\",\n    npm_config_arch: arch,\n    npm_config_target_arch: arch,\n    npm_config_platform: platform,\n    npm_config_build_from_source: buildFromSource,\n    HOME: gypHome,\n    USERPROFILE: gypHome,\n  })\n}\n\nfunction installDependencies(appDir: string, electronVersion: string, platform: string = process.platform, arch: string = process.arch, additionalArgs: Array<string>, buildFromSource: boolean): Promise<any> {\n  log(`Installing app dependencies for arch ${arch} to ${appDir}`)\n  let execPath = process.env.npm_execpath || process.env.NPM_CLI_JS\n  const execArgs = [\"install\", \"--production\"]\n\n  const isYarn = isYarnPath(execPath)\n  if (!isYarn) {\n    if (process.env.NPM_NO_BIN_LINKS === \"true\") {\n      execArgs.push(\"--no-bin-links\")\n    }\n    execArgs.push(\"--cache-min\", \"999999999\")\n  }\n\n  if (execPath == null) {\n    execPath = getPackageToolPath()\n  }\n  else {\n    execArgs.unshift(execPath)\n    execPath = process.env.npm_node_execpath || process.env.NODE_EXE || \"node\"\n  }\n\n  execArgs.push(...additionalArgs)\n  return spawn(execPath, execArgs, {\n    cwd: appDir,\n    env: getGypEnv(electronVersion, platform, arch, buildFromSource),\n  })\n}\n\nfunction getPackageToolPath() {\n  if (process.env.FORCE_YARN === \"true\") {\n    return process.platform === \"win32\" ? \"yarn.cmd\" : \"yarn\"\n  }\n  else {\n    return process.platform === \"win32\" ? \"npm.cmd\" : \"npm\"\n  }\n}\n\nfunction isYarnPath(execPath: string | null) {\n  return process.env.FORCE_YARN === \"true\" || (execPath != null && path.basename(execPath).startsWith(\"yarn\"))\n}\n\nexport async function rebuild(appDir: string, electronVersion: string, platform: string = process.platform, arch: string = process.arch, additionalArgs: Array<string>, buildFromSource: boolean) {\n  const pathToDep = await readInstalled(appDir)\n  const nativeDeps = await BluebirdPromise.filter(pathToDep.values(), it => it.extraneous ? false : exists(path.join(it.path, \"binding.gyp\")), {concurrency: 8})\n  if (nativeDeps.length === 0) {\n    log(`No native production dependencies`)\n    return\n  }\n\n  log(`Rebuilding native production dependencies for ${platform}:${arch}`)\n\n  let execPath = process.env.npm_execpath || process.env.NPM_CLI_JS\n  const isYarn = isYarnPath(execPath)\n  const execArgs: Array<string> = []\n  if (execPath == null) {\n    execPath = getPackageToolPath()\n  }\n  else {\n    execArgs.push(execPath)\n    execPath = process.env.npm_node_execpath || process.env.NODE_EXE || \"node\"\n  }\n\n  const env = getGypEnv(electronVersion, platform, arch, buildFromSource)\n  if (isYarn) {\n    execArgs.push(\"run\", \"install\", \"--\")\n    execArgs.push(...additionalArgs)\n    await BluebirdPromise.each(nativeDeps, dep => {\n      log(`Rebuilding native dependency ${dep.name}`)\n      return spawn(execPath, execArgs, {cwd: dep.path, env: env})\n        .catch(error => {\n          if (dep.optional) {\n            warn(`Cannot build optional native dep ${dep.name}`)\n          }\n          else {\n            throw error\n          }\n        })\n    })\n  }\n  else {\n    execArgs.push(\"rebuild\")\n    execArgs.push(...additionalArgs)\n    execArgs.push(...nativeDeps.map(it => it.name))\n    await spawn(execPath, execArgs, {cwd: appDir, env: env})\n  }\n}\n"
  ]
}
