{
  "version": 3,
  "file": "fpm.js",
  "sourceRoot": "",
  "sources": [
    "../../src/targets/fpm.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import BluebirdPromise from \"bluebird-lst\"\nimport { Arch, Target, toLinuxArchString } from \"electron-builder-core\"\nimport { exec, smarten, use } from \"electron-builder-util\"\nimport { getBin } from \"electron-builder-util/out/binDownload\"\nimport { unlinkIfExists } from \"electron-builder-util/out/fs\"\nimport { log, warn } from \"electron-builder-util/out/log\"\nimport { TmpDir } from \"electron-builder-util/out/tmp\"\nimport { ensureDir, outputFile, readFile } from \"fs-extra-p\"\nimport * as path from \"path\"\nimport * as errorMessages from \"../errorMessages\"\nimport { LinuxPackager } from \"../linuxPackager\"\nimport { DebOptions } from \"../options/linuxOptions\"\nimport { installPrefix, LinuxTargetHelper } from \"./LinuxTargetHelper\"\n\nconst fpmPath = (process.platform === \"win32\" || process.env.USE_SYSTEM_FPM === \"true\") ?\n  BluebirdPromise.resolve(\"fpm\") : downloadFpm()\n\n// can be called in parallel, all calls for the same version will get the same promise - will be downloaded only once\nfunction downloadFpm(): Promise<string> {\n  const version = process.platform === \"darwin\" ? \"fpm-1.6.3-20150715-2.2.2\" : \"fpm-1.6.3-2.3.1\"\n  const osAndArch = process.platform === \"darwin\" ? \"mac\" : `linux-x86${process.arch === \"ia32\" ? \"\" : \"_64\"}`\n  //noinspection SpellCheckingInspection\n  const sha2 = process.platform === \"darwin\" ? \"1b13080ecfd2b6fddb984ed6e1dfcb38cdf5b051a04d609c2a95227ed9a5ecbc\" :\n    (process.arch === \"ia32\" ? \"b55f25749a27097140171f073466c52e59f733a275fea99e2334c540627ffc62\" : \"4c6fc529e996f7ff850da2d0bb6c85080e43be672494b14c0c6bdcc03bf57328\")\n\n  return getBin(\"fpm\", version, `https://dl.bintray.com/electron-userland/bin/${version}-${osAndArch}.7z`, sha2)\n    .then(it => path.join(it, \"fpm\"))\n}\n\nexport default class FpmTarget extends Target {\n  private readonly options = Object.assign({}, this.packager.platformSpecificBuildOptions, (<any>this.packager.config)[this.name])\n\n  private readonly scriptFiles: Promise<Array<string>>\n\n  constructor(name: string, private readonly packager: LinuxPackager, private readonly helper: LinuxTargetHelper, readonly outDir: string) {\n    super(name, false)\n\n    this.scriptFiles = this.createScripts()\n  }\n\n  private async createScripts(): Promise<Array<string>> {\n    const defaultTemplatesDir = path.join(__dirname, \"..\", \"..\", \"templates\", \"linux\")\n\n    const packager = this.packager\n    const templateOptions = Object.assign({\n      // old API compatibility\n      executable: packager.executableName,\n      productFilename: packager.appInfo.productFilename,\n    }, packager.platformSpecificBuildOptions)\n\n    function getResource(value: string | n, defaultFile: string) {\n      if (value == null) {\n        return path.join(defaultTemplatesDir, defaultFile)\n      }\n      return path.resolve(packager.projectDir, value)\n    }\n\n    //noinspection ES6MissingAwait\n    return await BluebirdPromise.all<string>([\n      writeConfigFile(packager.info.tempDirManager, getResource(packager.platformSpecificBuildOptions.afterInstall, \"after-install.tpl\"), templateOptions),\n      writeConfigFile(packager.info.tempDirManager, getResource(packager.platformSpecificBuildOptions.afterRemove, \"after-remove.tpl\"), templateOptions)\n    ])\n  }\n\n  async build(appOutDir: string, arch: Arch): Promise<any> {\n    const target = this.name\n\n    log(`Building ${target}`)\n\n    const destination = path.join(this.outDir, this.packager.generateName(target, arch, true /* on Linux we use safe name â€” without space */))\n    await unlinkIfExists(destination)\n    if (this.packager.info.prepackaged != null) {\n      await ensureDir(this.outDir)\n    }\n\n    const scripts = await this.scriptFiles\n    const packager = this.packager\n    const appInfo = packager.appInfo\n\n    const projectUrl = await appInfo.computePackageUrl()\n    if (projectUrl == null) {\n      throw new Error(\"Please specify project homepage, see https://github.com/electron-userland/electron-builder/wiki/Options#AppMetadata-homepage\")\n    }\n\n    const options = this.options\n    let author = options.maintainer\n    if (author == null) {\n      const a = appInfo.metadata.author!\n      if (a.email == null) {\n        throw new Error(errorMessages.authorEmailIsMissed)\n      }\n      author = `${a.name} <${a.email}>`\n    }\n\n    const synopsis = options.synopsis\n    const args = [\n      \"-s\", \"dir\",\n      \"-t\", target,\n      \"--architecture\", (target === \"pacman\" && arch === Arch.ia32) ? \"i686\" : toLinuxArchString(arch),\n      \"--name\", appInfo.name,\n      \"--force\",\n      \"--after-install\", scripts[0],\n      \"--after-remove\", scripts[1],\n      \"--description\", smarten(target === \"rpm\" ? this.helper.getDescription(options)! : `${synopsis || \"\"}\\n ${this.helper.getDescription(options)}`),\n      \"--maintainer\", author,\n      \"--vendor\", options.vendor || author,\n      \"--version\", appInfo.version,\n      \"--package\", destination,\n      \"--url\", projectUrl,\n    ]\n\n    const packageCategory = options.packageCategory\n    if (packageCategory != null && packageCategory !== null) {\n      args.push(\"--category\", packageCategory)\n    }\n\n    if (target === \"deb\") {\n      args.push(\"--deb-compression\", options.compression || (packager.config.compression === \"store\" ? \"gz\" : \"xz\"))\n      use((<DebOptions>options).priority, it => args.push(\"--deb-priority\", it!))\n    }\n    else if (target === \"rpm\") {\n      // args.push(\"--rpm-compression\", options.compression || (this.config.compression === \"store\" ? \"none\" : \"xz\"))\n      args.push(\"--rpm-os\", \"linux\")\n\n      if (synopsis != null) {\n        args.push(\"--rpm-summary\", smarten(synopsis))\n      }\n    }\n\n    let depends = options.depends\n    if (depends == null) {\n      if (target === \"deb\") {\n        depends = [\"gconf2\", \"gconf-service\", \"libnotify4\", \"libappindicator1\", \"libxtst6\", \"libnss3\"]\n      }\n      else if (target === \"pacman\") {\n        depends = [\"c-ares\", \"ffmpeg\", \"gtk3\", \"http-parser\", \"libevent\", \"libvpx\", \"libxslt\", \"libxss\", \"minizip\", \"nss\", \"re2\", \"snappy\"]\n      }\n      else {\n        depends = []\n      }\n    }\n    else if (!Array.isArray(depends)) {\n      if (typeof depends === \"string\") {\n        depends = [<string>depends]\n      }\n      else {\n        throw new Error(`depends must be Array or String, but specified as: ${depends}`)\n      }\n    }\n\n    for (const dep of depends) {\n      args.push(\"--depends\", dep)\n    }\n\n    use(packager.appInfo.metadata.license, it => args.push(\"--license\", it!))\n    use(appInfo.buildNumber, it => args.push(\"--iteration\", it!))\n\n    use(options.fpm, it => args.push(...<any>it))\n\n    args.push(`${appOutDir}/=${installPrefix}/${appInfo.productFilename}`)\n    for (const mapping of (await this.helper.icons)) {\n      args.push(mapping.join(\"=/usr/share/icons/hicolor/\"))\n    }\n\n    const desktopFilePath = await this.helper.computeDesktopEntry(this.options)\n    args.push(`${desktopFilePath}=/usr/share/applications/${this.packager.executableName}.desktop`)\n\n    if (this.packager.packagerOptions.effectiveOptionComputed != null && await this.packager.packagerOptions.effectiveOptionComputed([args, desktopFilePath])) {\n      return\n    }\n\n    await exec(await fpmPath, args)\n\n    this.packager.dispatchArtifactCreated(destination, this)\n  }\n}\n\nasync function writeConfigFile(tmpDir: TmpDir, templatePath: string, options: any): Promise<string> {\n  //noinspection JSUnusedLocalSymbols\n  function replacer(match: string, p1: string) {\n    if (p1 in options) {\n      return options[p1]\n    }\n    else {\n      throw new Error(`Macro ${p1} is not defined`)\n    }\n  }\n  const config = (await readFile(templatePath, \"utf8\"))\n    .replace(/\\$\\{([a-zA-Z]+)\\}/g, replacer)\n    .replace(/<%=([a-zA-Z]+)%>/g, (match, p1) => {\n      warn(\"<%= varName %> is deprecated, please use ${varName} instead\")\n      return replacer(match, p1.trim())\n    })\n\n  const outputPath = await tmpDir.getTempFile(path.basename(templatePath, \".tpl\"))\n  await outputFile(outputPath, config)\n  return outputPath\n}\n"
  ]
}
